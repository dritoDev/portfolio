---
import "../styles/global.css";
import Icon from "./Icon.astro";
const links = [
  { href: "#skills", label: "Skills" },
  { href: "#projects", label: "Proyectos" },
  { href: "#about", label: "About" },
  { href: "#contact", label: "Contact" },
];
---

<div id="menu-overlay" class="menu-overlay"></div>

<nav id="mobile-menu" class="mobile-menu" aria-hidden="true">
  <a href="#home" class="icono-overlay">
    <Icon name="icono" size="2rem" color="white"/>
  </a>
  <h3>Menu</h3>
  <ul class="nav-links">
    {
      links.map((link) => (
        <li>
          <div>
            <a class="link" href={link.href}>{link.label}</a>
          </div>
          <div>
            <a class="link" href={link.href}>
              <Icon name="flecha" size="1.5rem" />
            </a>
          </div> 
        </li>
      ))
    }
  </ul>
</nav>

<style>
  .mobile-menu {
    position: fixed;
    top: 0;
    right: 0;
    width: 80%;
    max-width: 320px;
    height: 100vh;
    background: #0f172a;
    z-index: 90;

    transform: translateX(100%);
    transition: transform 0.3s ease;

    .icono-overlay {
      padding: var(--space-8) var(--space-8);
      display: var(--display-flex);
      justify-content: space-between;
      align-items: center;
      border-bottom: var(--color-gray-600) solid 1px;
    }
  }
  h3 {
    font-size: var(--text-lg);
    font-weight: var(--font-bold);
    color: var(--color-white);
    padding: 2rem var(--space-8);
  }

  .menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 80;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .menu-overlay.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  .mobile-menu.active {
    transform: translateX(0);
  }

  .mobile-menu .nav-links {
    list-style: none;
    padding: 0 2rem;
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    
  }
  .nav-links li {
    display: var(--display-flex);
    align-items: center;
    justify-content: space-between;
    max-width: var(--container-ms);
  }

  .mobile-menu .link {
    display: flex;
    padding: var(--space-1) var(--space-0);
    font-size: var(--text-sm);
    color: var(--color-white);
    text-decoration: none;
    align-items: center;
    text-shadow: var(--text-shadow-ms);
    transition: all var(--transition-base);
    &:hover {
      color: var( --color-primary-400);
      text-shadow: var(--text-shadow-lg);
    }
  }
</style>

<script is:inline>
  const toggle = document.querySelector(".nav-toggle");
  const menu = document.querySelector("#mobile-menu");
  const overlay = document.querySelector("#menu-overlay");
  const body = document.body;

  let focusableElements = [];
  let firstFocusableElement;
  let lastFocusableElement;

  function setFocusTrap() {
    focusableElements = menu.querySelectorAll(
      'a, button, [tabindex]:not([tabindex="-1"])',
    );
    firstFocusableElement = focusableElements[0];
    lastFocusableElement = focusableElements[focusableElements.length - 1];
    firstFocusableElement.focus();
  }

  function handleFocusTrap(e) {
    if (e.key !== "Tab") return;

    if (e.shiftKey && document.activeElement === firstFocusableElement) {
      e.preventDefault();
      lastFocusableElement.focus();
    } else if (!e.shiftKey && document.activeElement === lastFocusableElement) {
      e.preventDefault();
      firstFocusableElement.focus();
    }
  }

  function openMenu() {
    menu.classList.add("active");
    overlay.classList.add("active");
    toggle.classList.add("active");
    toggle.setAttribute("aria-expanded", "true");
    menu.setAttribute("aria-hidden", "false");
    body.classList.add("menu-open");

    setFocusTrap();
    document.addEventListener("keydown", handleFocusTrap);
  }

  function closeMenu() {
    menu.classList.remove("active");
    overlay.classList.remove("active");
    toggle.classList.remove("active");
    toggle.setAttribute("aria-expanded", "false");
    menu.setAttribute("aria-hidden", "true");
    body.classList.remove("menu-open");

    document.removeEventListener("keydown", handleFocusTrap);
    toggle.focus();
  }

  toggle.addEventListener("click", () => {
    menu.classList.contains("active") ? closeMenu() : openMenu();
  });

  overlay.addEventListener("click", closeMenu);

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && menu.classList.contains("active")) {
      closeMenu();
    }
  });

  menu.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", closeMenu);
  });
</script>
